---
- name: install abs
  pacman: name=abs state=present
  tags: [install]

- name: install base-devel packages
  pacman: name={{ item }} state=present
  with_items:
    - autoconf
    - automake
    - binutils
    - bison
    - fakeroot
    - flex
    - gcc
    - groff
    - libtool
    - m4
    - make
    - patch
    - pkg-config
  tags: [install]

- name: configure pacman to clean only outdated packages
  lineinfile:
    line: CleanMethod = KeepCurrent
    regexp: CleanMethod
    dest: /etc/pacman.conf
  tags: [configure]

- name: create a directory for the local repository
  file:
    dest: /srv/ftp/archlinux
    state: directory
  tags: [install]

- name: enable the home_network repository
  ini_file:
    section: home_network
    option: "{{ item.key }}"
    value: "{{ item.value }}"
    dest: /etc/pacman.conf
  with_dict:
    Server: "file:///srv/ftp/archlinux/$repo/os/$arch"
    SigLevel: Optional
  notify: update pacman cache
  tags: [serve]
