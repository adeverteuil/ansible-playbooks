---
- name: install letsencrypt client
  pacman: name=letsencrypt state=present

- name: create a webroot for letsencrypt
  file:
    path: "{{ letsencrypt_webroot }}"
    state: directory
    owner: http
    group: http
    mode: 0750

- name: configure letsencrypt
  template:
    src: cli.ini.j2
    dest: /etc/letsencrypt/cli.ini

- name: get the certificate
  command: letsencrypt certonly

- name: renew certificates weekly
  copy:
    src: letsencrypt-renew
    dest: /etc/cron.weekly/letsencrypt-renew
    mode: 0755

- name: restart Apache
  servce: name=httpd state=restarted
