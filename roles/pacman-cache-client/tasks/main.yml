---
- name: configure pacman to clean only outdated packages
  lineinfile:
    line: CleanMethod = KeepCurrent
    regexp: CleanMethod
    dest: /etc/pacman.conf
  tags: [configure]

- name: ensure linux-headers is installed
  pacman: name=linux-headers state=present

- name: enable the nf_conntrack_ftp module
  copy:
    src: nf_conntrack_ftp.conf
    dest: /etc/modules-load.d/nf_conntrack_ftp.conf
  tags: [configure]

- name: load the nf_conntrack_ftp module
  modprobe: name=nf_conntrack_ftp state=present
  tags: [serve]

- name: enable the home_network repository
  ini_file:
    section: home_network
    option: "{{ item.key }}"
    value: "{{ item.value }}"
    dest: /etc/pacman.conf
  with_dict:
    Server: "ftp://pacman-cache.private.deverteuil.net/archlinux/$repo/os/$arch"
    SigLevel: Optional
  notify: update pacman cache
  tags: [serve]
